<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Flights from Glasgow</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
select, button {
  padding: 10px;
  width: 100%;
  margin-top: 12px;
  margin-bottom: 20px;
}
    .result {
      margin-top: 20px;
    }
    .airline {
      margin-bottom: 16px;
    }
    .airline-name {
      font-weight: bold;
    }
  </style>
</head>

<body>

<h2>Flights from Glasgow</h2>

<p><strong>From:</strong> Glasgow</p>

<label for="country">Country (optional)</label>
<select id="country" onchange="updateDestinations()">
  <option value="">All countries</option>
</select>

<label for="destination">Destination</label>
<select id="destination">
  <option value="">Select destination</option>
</select>

<label for="day">Day of week (optional)</label>
<select id="day">
  <option value="">Any day</option>
  <option>Monday</option>
  <option>Tuesday</option>
  <option>Wednesday</option>
  <option>Thursday</option>
  <option>Friday</option>
  <option>Saturday</option>
  <option>Sunday</option>
</select>

<button onclick="findAirlines()">Show airlines</button>

<div id="results" class="result"></div>

<script>
let flights = [];

const dayOrder = [
  "Monday","Tuesday","Wednesday",
  "Thursday","Friday","Saturday","Sunday"
];

async function loadData() {
  const response = await fetch("/api/search?all=true");
  const data = await response.json();
  flights = data.flights;

  populateCountries();
  updateDestinations();
}

function populateCountries() {
  const countrySelect = document.getElementById("country");
  const countries = [...new Set(
    flights
      .filter(f => f.from === "Glasgow")
      .map(f => f.country)
      .filter(Boolean)
  )].sort();

  countries.forEach(country => {
    const option = document.createElement("option");
    option.value = country;
    option.textContent = country;
    countrySelect.appendChild(option);
  });
}

function updateDestinations() {
  const country = document.getElementById("country").value;
  const destinationSelect = document.getElementById("destination");

  const destinations = [...new Set(
    flights
      .filter(f =>
        f.from === "Glasgow" &&
        (!country || f.country === country)
      )
      .map(f => f.to)
  )].sort();

  destinationSelect.innerHTML = '<option value="">Select destination</option>';

  destinations.forEach(dest => {
    const option = document.createElement("option");
    option.value = dest;
    option.textContent = dest;
    destinationSelect.appendChild(option);
  });
}

function findAirlines() {
  const destination = document.getElementById("destination").value;
  const day = document.getElementById("day").value;
  const resultsDiv = document.getElementById("results");

  if (!destination) {
    resultsDiv.innerHTML = "Please select a destination.";
    return;
  }

  const matches = flights.filter(f =>
    f.from === "Glasgow" &&
    f.to === destination &&
    (!day || f.days.includes(day))
  );

  if (matches.length === 0) {
    resultsDiv.innerHTML = "No flights found.";
    return;
  }

  const airlineMap = {};

  matches.forEach(f => {
    if (!airlineMap[f.airline]) {
      airlineMap[f.airline] = new Set();
    }
    f.days.forEach(d => airlineMap[f.airline].add(d));
  });

  let html = `<h3>Airlines flying to ${destination}</h3>`;

  Object.keys(airlineMap).forEach(airline => {
    const days = Array.from(airlineMap[airline]).sort(
      (a, b) => dayOrder.indexOf(a) - dayOrder.indexOf(b)
    );

    html += `
      <div class="airline">
        <div class="airline-name">${airline}</div>
        <div>Days: ${days.join(", ")}</div>
      </div>
    `;
  });

  resultsDiv.innerHTML = html;
}

window.onload = loadData;
</script>

</body>
</html>



