<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Flights from Glasgow</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
    }
    select, button {
      padding: 8px;
      width: 100%;
      margin-top: 10px;
    }
    .result {
      margin-top: 20px;
    }
  </style>
</head>

<body>

<h2>Flights from Glasgow</h2>

<p><strong>From:</strong> Glasgow</p>

<label for="destination">Destination</label>
<select id="destination">
  <option value="">Loading destinations...</option>
</select>

<label for="day">Day of week</label>
<select id="day">
  <option value="">Select a day</option>
  <option>Monday</option>
  <option>Tuesday</option>
  <option>Wednesday</option>
  <option>Thursday</option>
  <option>Friday</option>
  <option>Saturday</option>
  <option>Sunday</option>
</select>

<button onclick="findAirlines()">Show airlines</button>

<div id="results" class="result"></div>

<script>
let flights = [];

async function loadData() {
  const response = await fetch("/api/search?all=true");
  const data = await response.json();
  flights = data.flights;

  const destinations = [...new Set(
    flights
      .filter(f => f.from === "Glasgow")
      .map(f => f.to)
  )].sort();

  const destinationSelect = document.getElementById("destination");
  destinationSelect.innerHTML = '<option value="">Select destination</option>';

  destinations.forEach(dest => {
    const option = document.createElement("option");
    option.value = dest;
    option.textContent = dest;
    destinationSelect.appendChild(option);
  });
}

function findAirlines() {
  const destination = document.getElementById("destination").value;
  const day = document.getElementById("day").value;
  const resultsDiv = document.getElementById("results");

  if (!destination) {
    resultsDiv.innerHTML = "Please select a destination.";
    return;
  }

  // Filter flights from Glasgow to destination
  let matches = flights.filter(f =>
    f.from === "Glasgow" &&
    f.to === destination
  );

  // Group by airline
  const airlineMap = {};

  matches.forEach(flight => {
    if (!airlineMap[flight.airline]) {
      airlineMap[flight.airline] = new Set();
    }
    flight.days.forEach(d => airlineMap[flight.airline].add(d));
  });

  // If day selected, remove airlines that don't fly that day
  if (day) {
    Object.keys(airlineMap).forEach(airline => {
      if (!airlineMap[airline].has(day)) {
        delete airlineMap[airline];
      }
    });
  }

  const airlines = Object.keys(airlineMap);

  if (airlines.length === 0) {
    resultsDiv.innerHTML = day
      ? `No flights to ${destination} on ${day}.`
      : `No flights to ${destination}.`;
    return;
  }

  let title = day
    ? `Airlines flying to ${destination} on ${day}`
    : `Airlines flying to ${destination}`;

  let html = `<h3>${title}</h3><ul>`;

  airlines.forEach(airline => {
    const days = Array.from(airlineMap[airline]).sort();
    html += `<li><strong>${airline}</strong> â€” ${days.join(", ")}</li>`;
  });

  html += "</ul>";
  resultsDiv.innerHTML = html;
}


window.onload = loadData;
</script>

</body>
</html>


